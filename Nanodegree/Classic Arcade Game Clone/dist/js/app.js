var gameFlag="started",Enemy=function(t,e,s){this.x=t,this.y=e,this.speed=s,this.sprite=Enemy.prototype.selectSprite()};Enemy.prototype={update:function(t){this.x+=this.speed*t,this.x>ctx.canvas.width&&(this.x=-60,this.speed=65*Math.floor(5*Math.random()+1),this.sprite=this.selectSprite()),this.checkCollisions()},checkCollisions:function(){var t=this.x-60,e=this.x+60,s=this.y,i=this.y+120;player.x>t&&player.x<e&&player.y>s&&player.y<i&&(player.resetPosition(),player.level=1)},render:function(){ctx.drawImage(Resources.get(this.sprite),this.x,this.y)},selectSprite:function(){var t,e=100*Math.random();return e>=0&&e<25&&(t="images/char-boy.png"),e>=25&&e<50&&(t="images/char-cat-girl.png"),e>=50&&e<75&&(t="images/char-horn-girl.png"),e>=75&&e<100&&(t="images/char-pink-girl.png"),t}};var Player=function(t){this.startX=205,this.startY=460,this.x=this.startX,this.y=this.startY,this.sprite="images/enemy-bug_right.png",this.status="stop",this.level=1};Player.prototype={update:function(t){this.move(t),this.changeSprite()},handleInput:function(t){switch(t){case"left":this.status="moveLeft";break;case"right":this.status="moveRight";break;case"up":this.status="moveTop";break;case"down":this.status="moveBottom";break;default:this.status="stop"}},move:function(t){"moveLeft"===this.status&&this.x>0&&(this.x-=160*t),"moveRight"===this.status&&this.x<ctx.canvas.width-100&&(this.x+=160*t),"moveTop"===this.status&&this.y>52&&(this.y-=130*t),"moveBottom"===this.status&&this.y<ctx.canvas.height-100&&(this.y+=130*t)},changeSprite:function(){"moveLeft"===this.status&&(this.sprite="images/enemy-bug_left.png"),"moveRight"===this.status&&(this.sprite="images/enemy-bug_right.png"),"moveTop"===this.status&&(this.sprite="images/enemy-bug_top.png"),"moveBottom"===this.status&&(this.sprite="images/enemy-bug_bottom.png")},resetPosition:function(){this.x=this.startX,this.y=this.startY,this.sprite="images/enemy-bug_right.png",key.status="onground"},render:function(){ctx.drawImage(Resources.get(this.sprite),this.x,this.y),ctx.font="40px Arial Black",ctx.fillStyle="white",ctx.fillText("Level "+this.level,30,105),ctx.strokeStyle="black",ctx.strokeText("Level "+this.level,30,105)}};var Stone=function(t){this.x=101*Math.floor(7*Math.random()),this.y=t,this.sprite="images/Rock.png"};Stone.prototype={update:function(t){this.checkCollisions()},checkCollisions:function(){var t=this.x-90,e=this.x+90,s=this.y,i=this.y+140;if(player.x>t&&player.x<e&&player.y>s&&player.y<i)switch(player.status){case"moveLeft":player.status="stop",Math.abs(player.x-e)<Math.abs(player.x-t)?player.x=e:player.x=t;break;case"moveRight":player.status="stop",Math.abs(player.x-t)<Math.abs(player.x-e)?player.x=t:player.x=e;break;case"moveTop":player.status="stop",Math.abs(player.y-i)<Math.abs(player.y-s)?player.y=i:player.y=s;break;case"moveBottom":player.status="stop",Math.abs(player.y-s)<Math.abs(player.y-i)?player.y=s:player.y=i}},reset:function(){this.x=101*Math.floor(7*Math.random())},render:function(){ctx.drawImage(Resources.get(this.sprite),this.x,this.y)}};var Key=function(t){this.x=101*(Math.floor(5*Math.random())+1),this.y=t,this.sprite="images/Key.png",this.width=20,this.height=50,this.status="onground"};Key.prototype={update:function(t){this.checkCollisions()},checkCollisions:function(){var t=this.x-60,e=this.x+60,s=this.y,i=this.y+120;player.x>t&&player.x<e&&player.y>s&&player.y<i&&(this.status="picked")},reset:function(){this.x=101*(Math.floor(5*Math.random())+1)},render:function(){"onground"===this.status&&ctx.drawImage(Resources.get(this.sprite),this.x,this.y)}};var Door=function(t,e){this.x=t,this.y=e,this.sprite="images/Selector.png"};Door.prototype={update:function(t){this.checkCollisions()},checkCollisions:function(){var t=this.x-10,e=this.x+10,s=this.y-10,i=this.y+10;if(player.level<3&&"picked"===key.status&&player.x>t&&player.x<e&&player.y>s&&player.y<i){key.status="onground",player.resetPosition(),player.level++;for(var a=0;a<allStones.length;a++)allStones[a].reset();key.reset()}},render:function(){player.level<3&&ctx.drawImage(Resources.get(this.sprite),this.x,this.y)}};var Princess=function(t,e){this.x=t,this.y=e,this.sprite="images/bug_princess.png"};Princess.prototype={update:function(t){this.checkCollisions()},checkCollisions:function(){var t=this.x-90,e=this.x+80,s=this.y-80,i=this.y+80;3===player.level&&"picked"===key.status&&player.x>t&&player.x<e&&player.y>s&&player.y<i&&(gameFlag="end")},render:function(){3===player.level&&ctx.drawImage(Resources.get(this.sprite),this.x,this.y)}};var allEnemies=[new Enemy(0,60,290),new Enemy(0,140,200),new Enemy(0,230,400),new Enemy(0,320,320)];player=new Player;var allStones=[new Stone(60),new Stone(230),new Stone(310)],key=new Key(140),door=new Door(505,50),princess=new Princess(606,50);document.addEventListener("keydown",function(t){var e={37:"left",38:"up",39:"right",40:"down"};player.handleInput(e[t.keyCode])}),document.addEventListener("keyup",function(t){var e={37:"stand",38:"stand",39:"stand",40:"stand"};player.handleInput(e[t.keyCode])});